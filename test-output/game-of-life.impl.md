---
artifact: game-of-life
phase: implementation
depends-on: [game-of-life.req, game-of-life.design]
references: []
version: 1.0.0
last-updated: 2025-12-16
---

# Game of Life - Implementation

## File Structure
The application is structured as a client-server architecture to support both base Game of Life functionality and multiplayer collaboration. The client-side is a single-page application (SPA) built with React, and the server-side handles real-time synchronization. Files are organized into directories for clarity. New files and directories for multiplayer collaboration are explicitly included.

### Root Directory
- `package.json`: Defines dependencies for the entire project, including client and server. Includes scripts for building, running, and testing. Dependencies: React, Socket.IO (client and server), Express, Canvas (via react-canvas or similar for rendering), WebGL (via Three.js or PIXI.js for large grids).
- `README.md`: Project documentation, including setup instructions for both client and server, and multiplayer usage notes.
- `server/`: Directory for server-side code.
- `client/`: Directory for client-side code.
- `shared/`: Directory for shared utilities between client and server (e.g., game logic constants).

### Server Directory (`server/`)
- `server.js`: Main server entry point using Express and Socket.IO. Handles HTTP requests, serves static files, and manages WebSocket connections for multiplayer sessions.
- `routes/`: Subdirectory for API routes.
  - `session.js`: Handles session creation, joining, and management (e.g., room-based collaboration).
- `models/`: Subdirectory for data models.
  - `session.js`: Defines the Session model, including room ID, user list, and grid state synchronization logic.
- `utils/`: Subdirectory for utilities.
  - `gridSync.js`: Utility functions for broadcasting grid state changes to all users in a session.
  - `validation.js`: Validates incoming grid updates for consistency and security.

### Client Directory (`client/`)
- `public/`: Static assets.
  - `index.html`: Main HTML file for the SPA.
  - `favicon.ico`: App icon.
- `src/`: Source code.
  - `components/`: React components.
    - `Grid.js`: Component for rendering the grid using Canvas/WebGL. Handles cell toggling and visualization.
    - `Controls.js`: Component for simulation controls (play/pause, step, reset, speed adjustment).
    - `PatternLibrary.js`: Component for loading predefined patterns (e.g., Gosper Glider Gun).
    - `MultiplayerPanel.js`: New component for multiplayer features: join/create session, user list, chat (optional), and session status.
  - `hooks/`: Custom React hooks.
    - `useGameLogic.js`: Hook for core simulation logic (cell rules, generation updates).
    - `useMultiplayer.js`: New hook for managing WebSocket connections, session joining, and real-time grid synchronization.
  - `services/`: Service layer.
    - `socketService.js`: New service for Socket.IO client integration, handling events like 'join-session', 'update-grid', 'sync-state'.
    - `apiService.js`: For non-real-time API calls (e.g., fetching patterns).
  - `utils/`: Utilities.
    - `gridUtils.js`: Functions for grid manipulation (e.g., initializing large grids up to 10,000x10,000).
    - `patternUtils.js`: Functions for loading and applying patterns.
    - `multiplayerUtils.js`: New utilities for conflict resolution (e.g., last-writer-wins for simultaneous edits) and debouncing updates.
  - `App.js`: Main App component, integrating all sub-components and handling global state.
  - `index.js`: Entry point for React app.
- `build/`: Build output (generated by tools like Webpack).
- `tests/`: Test files (e.g., using Jest for unit tests, including multiplayer scenarios).

### Shared Directory (`shared/`)
- `constants.js`: Shared constants, such as grid rules, max grid size, and event types (e.g., 'GRID_UPDATE', 'SESSION_JOIN').
- `types.js`: TypeScript-style definitions or JSDoc for data structures (e.g., Grid state as a 2D array, Session object).

## Module Implementation
Modules are implemented with precise details, focusing on modularity, performance, and integration. Multiplayer collaboration is integrated as a core feature, with client-side simulation logic augmented by server-side synchronization to ensure real-time consistency across users in a shared session. The server acts as the authoritative source for grid state in multiplayer mode, while clients maintain local copies for responsiveness.

### Base Game Logic Module (Client-Side)
- **Grid Module (`src/utils/gridUtils.js`)**: Implements grid as a sparse 2D array (e.g., Map or Object for efficiency with large grids). Functions include `initializeGrid(width, height)`, `toggleCell(x, y)`, `getNeighbors(x, y)`, and `nextGeneration()` applying Conway's rules. Optimizes for performance: Use bit-packing for cells if needed, and WebGL rendering for grids >1000x1000.
- **Simulation Module (`src/hooks/useGameLogic.js`)**: React hook managing simulation state (playing/paused, current generation). Uses requestAnimationFrame for smooth updates. Integrates with `gridUtils.js` for state transitions. For large grids, offloads computation to Web Workers to avoid UI blocking.

### Multiplayer Collaboration Modules
- **Server-Side Session Management (`server/models/session.js` and `server/routes/session.js`)**: Each session is a "room" identified by a unique ID (generated via UUID). Tracks connected users (via Socket.IO sockets), grid state (serialized as JSON), and history of changes. API endpoints: POST `/sessions/create` (creates room, returns ID), POST `/sessions/join/:id` (joins room if exists). On join, server emits 'sync-state' with current grid to the new user.
- **Grid Synchronization (`server/utils/gridSync.js`)**: Handles broadcasting. When a client sends 'update-grid' (e.g., cell toggle), server validates (e.g., against rate limits to prevent spam), applies change to authoritative state, and emits 'grid-updated' to all room members except sender. Uses conflict resolution: If multiple updates arrive simultaneously, apply in timestamp order (server timestamps events).
- **Client-Side Multiplayer Integration (`src/hooks/useMultiplayer.js` and `src/services/socketService.js`)**: `useMultiplayer` hook connects to server via Socket.IO, manages session state (joined/not joined, user list), and subscribes to events. On 'grid-updated', merges incoming changes into local grid (replacing conflicting cells). `socketService` emits 'join-session' on room entry and 'update-grid' on local changes (debounced to 100ms to reduce traffic). Local simulation pauses during multiplayer mode; only server-broadcasted updates advance generations.
- **Multiplayer UI Module (`src/components/MultiplayerPanel.js`)**: Displays session ID, list of users (real-time via socket events), and buttons for "Create Session" (generates ID, joins locally, prompts to share), "Join Session" (input field for ID), and optional "Chat" (simple text input emitting 'chat-message' to room). Integrates with `useMultiplayer` for state.
- **Shared Utilities (`shared/constants.js` and `client/src/utils/multiplayerUtils.js`)**: Defines event constants (e.g., 'JOIN_SESSION', 'GRID_UPDATE'). `multiplayerUtils.js` includes `debounceUpdates()` for throttling emits and `resolveConflicts()` for handling overlapping edits (e.g., merge by prioritizing server state).

### Rendering and Performance Modules
- **Rendering Module (`src/components/Grid.js`)**: Uses Canvas 2D for small grids (<500x500), WebGL (via PIXI.js) for larger. Cells rendered as pixels/rectangles. For multiplayer, highlights active user's cursor or recent changes (e.g., via temporary color overlays).
- **Pattern Library Module (`src/components/PatternLibrary.js`)**: Loads JSON patterns from `/public/patterns/`. On load, applies to grid locally, then emits 'update-grid' if in multiplayer mode.

All modules handle errors gracefully (e.g., connection loss reconnects via Socket.IO), and security measures include input sanitization and rate limiting on server.

## Code Generation Instructions
Generate code exactly as specified below. Use ES6+ syntax, React functional components with hooks, and Node.js for server. Ensure multiplayer collaboration is fully implemented: Clients join sessions, synchronize grid state via WebSockets, and handle real-time updates without desync.

### Server Code Generation
1. In `server/server.js`: Implement Express app listening on port 3001. Use Socket.IO with CORS enabled for client (origin: 'http://localhost:3000'). On 'connection', listen for 'join-session' (validate room ID, add socket to room, emit 'sync-state' with current grid from session model). On 'update-grid' (payload: {x, y, state}), update server grid, broadcast 'grid-updated' to room. Store grid in memory per room (use Map for sessions).
2. In `server/models/session.js`: Export class Session { constructor(id) { this.id = id; this.grid = initializeEmptyGrid(100,100); this.users = []; } addUser(socket) { this.users.push(socket.id); } removeUser(socket) { this.users = this.users.filter(id => id !== socket.id); } updateGrid(x,y,state) { this.grid[y][x] = state; } }.
3. In `server/routes/session.js`: Export router with POST '/create' returning {sessionId: uuid.v4()}, and POST '/join/:id' checking if session exists, adding user if so.

### Client Code Generation
1. In `src/services/socketService.js`: Export const socket = io('http://localhost:3001'); Export functions: joinSession(sessionId) { socket.emit('join-session', sessionId); }, updateGrid(x,y,state) { socket.emit('update-grid', {x,y,state}); }, onSyncState(callback) { socket.on('sync-state', callback); }, onGridUpdated(callback) { socket.on('grid-updated', callback); }.
2. In `src/hooks/useMultiplayer.js`: Use useState for sessionId, users, isJoined. Use useEffect to connect socket on mount. Define joinSession(id) { socketService.joinSession(id); setIsJoined(true); setSessionId(id); }, and listeners: socketService.onSyncState((grid) => setLocalGrid(grid)); socketService.onGridUpdated((update) => applyUpdateToLocalGrid(update)); Return { joinSession, sessionId, users, isJoined }.
3. In `src/components/MultiplayerPanel.js`: Render input for session ID, buttons "Create" (generate UUID, joinSession), "Join" (joinSession with input value). Display sessionId and users list (fetched from hook).
4. In `src/hooks/useGameLogic.js`: Modify to accept multiplayer hook. If multiplayer.isJoined, disable local stepping; only update grid on 'grid-updated' events.
5. In `src/components/Grid.js`: On cell click, if multiplayer, call socketService.updateGrid(x,y,newState) instead of local toggle.

Build and run: Use `npm start` for client (React dev server on 3000), `node server/server.js` for server. Test multiplayer by opening multiple browser tabs, creating/joining sessions, and verifying grid sync. Ensure no desync on simultaneous edits.