=== AI Response Log: generateDesign ===
Timestamp: 2025-12-17T22:49:42.003Z

=== System Prompt ===
You are an expert software architect. Generate a PromptPress design specification following this exact structure:

```
---
artifact: geode-calcite
phase: design
depends-on: []
references: ["geode-calcite.req", "faction.req", "faction.design"]
version: 1.0.0
last-updated: 2025-12-17
---

# [Title] - Design

## Overview
[High-level design approach]

## Architecture
[System components, modules, layers]

## API Contracts
[Interfaces, function signatures, data structures]

## Data Model
[Database schema, data structures, relationships]

## Algorithms & Logic
[Key algorithms, decision flows, business logic]

## Dependencies
[Third-party libraries, external services]

## Questions & Clarifications
[AI-CLARIFY: Design decisions that need input?]

## Cross-References
[Leave empty - references are documented in the metadata header above]

## AI Interaction Log
<!-- Auto-maintained by PromptPress extension -->
```

Generate a complete, detailed design specification. Be precise about architecture and APIs.

=== User Prompt ===
Generate a design specification for:

Describes the Calcite geode as described in @faction.req

Concept of Operations:

### Gap Analysis
- **ConOps gaps**: The existing ConOps document covers the overall game concept, scenarios, and high-level geode powers (e.g., Pyrite's movement and role as erosion target), but it does not detail the specific powers and mechanics for other geodes like Amethyst (diagonal movement, purple lines) and Rose Quartz (enhanced capture abilities). These are now addressed in new requirement overviews (geode-amethyst.req.md and geode-rose-quartz.req.md), but the ConOps lacks references to them and does not incorporate their operational implications (e.g., how Amethyst's diagonal movement or Rose Quartz's capture rules affect turn-based strategies). Additionally, the ConOps assumes geode powers are fully detailed in faction.req.md, but faction.req.md provides a high-level overview without the granular mechanics now specified in the individual geode req.md files.
- **Requirement gaps**: The requirement overviews provide detailed mechanics for individual geodes (e.g., Amethyst's purple lines and movement rules, Rose Quartz's capture enhancements), but the ConOps does not reflect these in its operational scenarios, traceability, or success criteria (e.g., no mention of balancing win rates with these specific powers). The ConOps references only a subset of the provided req.md files (missing geode-amethyst.req.md and geode-rose-quartz.req.md), leading to incomplete traceability. Some overviews (e.g., game-state-manager.req.md, rules-engine.req.md) emphasize integration and validation, but the ConOps could better detail how these support real-time play with the new geode mechanics. No major aspects are missing from the overviews themselves, but they could be inferred to require minor updates for consistency with the ConOps (e.g., ensuring faction.req.md cross-references the individual geode req.md).
- **Completeness assessment**: The current requirements and ConOps are largely aligned for the core game mechanics (board, fissures, state management, rules, UI, and Pyrite), providing sufficient coverage for a functional web-based game. However, the addition of detailed geode-specific req.md (amethyst and rose quartz) fills previous gaps in strategic depth, making the overall set more complete. With updates to incorporate these, the requirements fully support the operational concept, including balanced gameplay, real-time interactions, and win conditions. The system is operationally ready for implementation, but the ConOps needs expansion for comprehensive documentation.

### Recommended Updates
- **ConOps updates**: Update the references to include geode-amethyst.req.md and geode-rose-quartz.req.md. Expand the Operational Scenarios section to detail how Amethyst's diagonal movement and purple lines, and Rose Quartz's capture abilities, integrate into gameplay (e.g., in Scenario 2: Turn-Based Gameplay and Strategy). Update Requirements Traceability to include the new files, describing their contributions to operations (e.g., Amethyst's strategic positioning, Rose Quartz's aggressive plays). Revise success criteria to mention balancing with these specific powers. Ensure all geode powers are briefly summarized in the Operational Concept for completeness.
- **Requirement updates**: The provided requirement overviews are largely sufficient, but minor updates are recommended for consistency and cross-referencing to align with the updated ConOps and ensure all geode req.md are linked. Specifically:
  - **File**: faction.req.md
    - **Updated Overview**: This requirement specification outlines the design and implementation of a collection of 5 unique geodes, each possessing distinct special powers. The geodes are intended as collectible artifacts for use in the board game "petrified". Each geode must be visually distinct as each piece will have unique powers on the game board. The base faction consists of Pyrite (@geode-pyrite.req.md), Rose Quartz (@geode-rose-quartz.req.md), Calcite, Amethyst (@geode-amethyst.req.md) and Quartz and is collectively called **The Crystalline Guard**. Operationally, players control these geodes in web-based sessions, selecting and moving them strategically during turns, with Pyrite serving as the critical erosion target, under constraints like real-time validation and balanced win rates to promote user engagement.
  - **File**: game-board.req.md
    - **Updated Overview**: This requirement specification details the design and functionality of the game board for the board game "Petrified." "Petrified" is a turn-based strategy game involving piece placement on a grid, with the end result being to capture all of the opponents pieces. It is a two-player web-based game, where players access the board via standard web browsers and interact through a responsive UI to place, move, and rotate elements in real-time. The board is laid out as follows:

      |   | 1 | 2 | 3 | 4 | 5 |
      |---|---|---|---|---|---|
      | 1 | Pyrite | Rose Quartz | Calcite | Amethyst | Quartz |
      | 2 | Fissure | Fissure | Fissure | Fissure | Fissure |
      | 3 | Fissure | Fissure | Center Fissure | Fissure | Fissure |
      | 4 | Fissure | Fissure | Fissure | Fissure | Fissure |
      | 5 | Pyrite | Rose Quartz | Calcite | Amethyst | Quartz |

      The game board is a 5x5 grid structure that serves as the playing surface, where players interact with both game pieces and the board itself according to the game's rules. The board must visually represent the grid, support piece placement and movement, and provide feedback on game state. The physical board is composed of 25 "cells". Each player plays with a "faction" of 5 "geodes". Both players play with identical factions and each faction is composed of 5 distinct types of geode. Each geode has a different skill, allowing it to behave uniquely (see @geode-pyrite.req.md, @geode-rose-quartz.req.md, @geode-amethyst.req.md, and faction.req.md for details). The "cells" in rows 2-4 can be rotated to affect how the "geode" interacts with that cell. The cells in rows 1 and 5 are called "strata" and these are the home positions for each faction. The baseline faction is made of Pyrite, Rose Quartz, Calcite, Amethyst and Quartz. The cells in rows 2-4 can be rotated affecting movement characteristics of most geodes, allowing some to enter the cell and others to be blocked from entering. The goal of the game is to "Erode the other players Pyrite"; every faction must contain at least one piece Pyrite. Operationally, players alternate turns, with constraints such as browser-based responsiveness and no offline play, ensuring fair, interactive gameplay.
  - **File**: rules-engine.req.md
    - **Updated Overview**: The Game Rules Engine is a software component responsible for enforcing the core mechanics of Petrified. It manages turn sequencing to ensure fair play, validates all proposed moves for legality and adherence to game rules, handles capture mechanics for removing opponent pieces (including enhanced captures for geodes like Rose Quartz from @geode-rose-quartz.req.md), determines win/loss conditions based on game state, and applies any special rules including the effects of rotating fissures on the board and faction-specific rules for geodes (e.g., movement and abilities from @geode-pyrite.req.md, @geode-amethyst.req.md, and faction.req.md). This engine must integrate seamlessly with a game board state manager and user interface to provide a complete, rule-compliant gaming experience. The engine should be modular to support different games by configuration.
  - **File**: ui-ux.req.md
    - **Updated Overview**: This requirement specification details the web components, HTML structure, and CSS styling necessary to implement the user interface (UI) and user experience (UX) for the game board, faction pieces (geodes), and fissures in the web-based version of the board game "Petrified." It builds upon the game board layout and geode definitions from the referenced requirements (@game-board.req.md, @faction.req.md, @geode-pyrite.req.md, @geode-rose-quartz.req.md, @geode-amethyst.req.md), ensuring a responsive, interactive, and visually appealing web interface. The implementation must support a 5x5 grid layout, visually distinct geodes with hover and selection states, rotatable fissures in specific rows, and overall game state feedback. The UI should be built using modern web technologies, prioritizing accessibility, performance, and cross-browser compatibility. The goal of the game is to "Erode the other players Pyrite"; every faction must contain at least one piece Pyrite.

      Five starter geodes have been identified and should be colored as follows:
      pyrite (yellow), rose-quartz (pink), calcite (white/clear), amethyst (purple), quartz (white/clear)
- **New requirements needed**: No new req.md documents are needed, as the provided set (including the newly added geode-amethyst.req.md and geode-rose-quartz.req.md) sufficiently covers all aspects. However, if future expansions (e.g., networking for multiplayer) are considered, a networking.req.md could be added, but it's not required for current completeness.

### Updated Content
Below is the complete updated ConOps.md content with all recommended changes incorporated. The document has been expanded to include references to geode-amethyst.req.md and geode-rose-quartz.req.md, updated operational scenarios to detail the new geode mechanics, revised traceability, and minor refinements for completeness and balance.

---
artifact: conops
phase: concept
depends-on: []
references: [faction.req.md, fissure-cell.req.md, game-board.req.md, game-state-manager.req.md, geode-pyrite.req.md, geode-rose-quartz.req.md, geode-amethyst.req.md, rules-engine.req.md, ui-ux.req.md]
version: 1.3.0
last-updated: 2025-12-17
---

# Concept of Operations (ConOps)

## Executive Summary
Petrified is a two-player, turn-based strategy board game implemented as a web-based application. Players compete to erode the opponent's Pyrite geode by strategically placing and moving geodes on a 5x5 grid board featuring rotatable fissures. The game emphasizes strategic depth through unique geode powers (e.g., Pyrite's directional movement, Rose Quartz's enhanced captures, Amethyst's diagonal traversal and purple lines, with Calcite and Quartz powers to be detailed), fissure rotations affecting movement, and visual distinctions for immersive play. This ConOps outlines how the system supports gameplay in a web environment, ensuring fair, rule-compliant experiences for users.

## Business Objectives
- Provide an engaging, accessible web-based strategy game that promotes strategic thinking and competition.
- Enable easy deployment and play in standard web browsers without requiring specialized hardware or software installations.
- Deliver a complete gaming experience, from setup to win/loss determination, with real-time state management and feedback.
- Success criteria: Achieve a user satisfaction rating of 80%+ via post-game surveys, with average game completion time under 15 minutes and win rates balanced (e.g., 50/50 for skilled players) through fair geode power designs, including specific mechanics like Pyrite's movement, Rose Quartz's capture enhancements, and Amethyst's strategic positioning to ensure equitable gameplay.
- Value proposition: Offers a free, browser-based alternative to physical board games, combining collectible elements with dynamic strategy for casual and competitive players.

## Stakeholders
- **Players**: End-users (two per game session) who interact with the UI to place, move, and rotate elements, adhering to game rules. Responsibilities include turn-taking, strategic decision-making, and understanding geode powers (e.g., Pyrite as the erosion target, Rose Quartz for aggressive captures, Amethyst for diagonal mobility).
- **Game Administrators/Developers**: Responsible for deploying and maintaining the web application, ensuring rules are enforced and UI is functional. They may handle future updates based on user feedback.
- **External Systems/Interfaces**: Web browsers (e.g., Chrome, Firefox) for rendering the UI hosted on GitHub Pages or other CDN. Data persistence will be satisfied using https://jsonbin.io/; users must paste an API key into the browser to create a shared game.

## Operational Concept
### Current State
Traditional board games require physical components, limiting accessibility and scalability. Players face challenges in setup, rule enforcement, and state tracking, leading to disputes or incomplete games. Web-based alternatives exist but often lack the tactile strategy of Petrified's rotatable fissures and unique geodes.

### Proposed Solution
The system operates as a web application where players access a responsive UI via browsers. The game board is a 5x5 grid with strata (home rows) and rotatable fissures. Players control identical factions of 5 geodes (Pyrite - yellow, erosion target with movement 1 cell in any direction; Rose Quartz - pink, enhanced capture (e.g., adjacent opponents); Amethyst - purple, diagonal movement any number of spaces and access to purple lines; Calcite - white/clear, movement boosts; Quartz - white/clear, fissure manipulation—details to be specified in faction.req.md and individual geode req.md). Turns involve placing/moving geodes, rotating fissures (which affect cell entry for certain geodes, e.g., blocking or allowing based on rotation and geode type), and capturing opponents. The rules engine validates actions, the state manager tracks changes, and the UI provides visual feedback with distinct colors and hover states. Play continues until one player's Pyrite is eroded (captured or unable to move).

### Operational Scenarios
- **Scenario 1: Game Setup and Initial Placement**: Players access the web app and select to start a new game. The board initializes with geodes in strata positions (e.g., Player 1's Pyrite in row 1, column 1) and fissures in neutral orientations. Player 1 places their first geode, rotating a fissure if desired (affecting future movement). The UI updates in real-time with visual distinctions (e.g., pyrite in yellow), and the state manager records positions. (Addresses initial user interaction and state initialization from game-state-manager.req.md and ui-ux.req.md.)
- **Scenario 2: Turn-Based Gameplay and Strategy**: During a turn, a player selects a geode (e.g., Pyrite moves 1 cell in any direction, Rose Quartz captures adjacent opponents, Amethyst traverses diagonally or accesses purple lines on the center fissure), chooses a valid move (validated by rules-engine.req.md), and optionally rotates a fissure (determining which geodes can enter/traverse based on rotation and type, e.g., blocking some while permitting others). If a capture occurs (e.g., landing on an opponent via geode power like Rose Quartz's enhancements), the opponent's piece is removed. The UI highlights valid moves, provides feedback on game state, and shows fissure orientations. Play alternates until win conditions are met. (Covers turn sequencing, validation, captures, and fissure effects from rules-engine.req.md, game-board.req.md, fissure-cell.req.md, geode-pyrite.req.md, geode-rose-quartz.req.md, geode-amethyst.req.md, and faction.req.md.)
- **Scenario 3: Endgame and Win Determination**: As pieces are captured, the state manager checks for the erosion of Pyrite (the sole win condition). The UI displays a win/loss message, allowing players to restart or exit. (Addresses win/loss logic from rules-engine.req.md and state tracking from game-state-manager.req.md.)

## Functional Requirements Overview
The system must support geode placement/movement (with unique powers for strategy, e.g., Pyrite's directional movement, Rose Quartz's capture enhancements, Amethyst's diagonal mobility and purple lines), fissure rotation (impacting cell access based on geode types), turn validation, captures, and win/loss checks focused on Pyrite erosion. It requires visual representation of the board, geodes (with specified colors), and fissures, with interactive UI elements for selection and feedback.

## Non-Functional Requirements Overview
- **Performance**: Real-time updates with <2-second latency for moves in standard web browsers.
- **Security**: No sensitive data handling; basic input validation to prevent cheating.
- **Usability**: Responsive design for desktop/mobile, with accessibility features (e.g., keyboard navigation, screen reader support) and visual distinctions for geodes and fissures.
- **Scalability**: Support for single-session games; extensible to multiplayer if networked.

## Constraints and Assumptions
- **Technical Constraints**: Must run in modern web browsers (e.g., HTML5+ support); no offline mode; assumes stable internet for loading.
- **Business Constraints**: Two-player only; no monetization or user accounts initially.
- **Assumptions**: Players have basic web literacy; game rules are self-explanatory via UI tooltips; fissures' rotation effects are predefined and balanced; geode powers (including Pyrite's, Rose Quartz's, and Amethyst's specifics) are fair to ensure 50/50 win rates.

## Risks and Mitigations
- **Risk 1: Rule Misinterpretation Leading to Invalid Moves**: Mitigation - Robust validation in rules-engine.req.md and UI feedback.
- **Risk 2: Browser Incompatibility Causing UI Issues**: Mitigation - Cross-browser testing and fallback CSS from ui-ux.req.md.
- **Risk 3: State Loss During Play**: Mitigation - Client-side state persistence with warnings from game-state-manager.req.md.

## Future Considerations
Potential roadmap includes multiplayer over networks (requiring new networking.req.md), AI opponents, mobile app ports, and custom faction expansions for enhanced scalability and engagement.

## Gap Analysis
See the Gap Analysis section above in this document for details on alignment with requirements.

## Recommended Updates
See the Recommended Updates section above in this document for suggestions.

## Requirements Traceability
- **faction.req.md**: Addresses geode design, powers (e.g., unique abilities for movement and capture, such as Pyrite's directional movement and erosion role, Rose Quartz's enhanced captures, Amethyst's diagonal traversal), faction naming (The Crystalline Guard), and visual distinctions, supporting operational scenarios where players select and use geodes strategically (e.g., Pyrite as the key target; note: other powers like Calcite and Quartz need detailing for full workflows).
- **fissure-cell.req.md**: Defines fissure cell design, rotation mechanics (altering orientations to block/permit geode entry based on types), and integration with state management, enabling operational workflows for turn-based rotation and movement impacts in gameplay scenarios.
- **game-board.req.md**: Defines the board layout, mechanics (e.g., strata as home rows, fissure rows), and operational constraints (e.g., turn alternation, browser responsiveness), enabling workflows for piece placement, movement, and rotation.
- **game-state-manager.req.md**: Manages real-time state (positions, turns, fissures), ensuring operational consistency in tracking changes during play.
- **geode-pyrite.req.md**: Specifies Pyrite's movement (1 cell in any direction), capture rules as the erosion target, and visual aspects (yellow color), supporting endgame operational scenarios and win determination.
- **geode-rose-quartz.req.md**: Details Rose Quartz's enhanced capture abilities (e.g., adjacent opponent removal), visual aspects (pink color), and integration with board and fissures, enabling aggressive strategic plays in turn-based scenarios to erode Pyrite.
- **geode-amethyst.req.md**: Defines Amethyst's diagonal movement (any number of spaces), purple line access (on the center fissure), and visual aspects (purple color), supporting operational workflows for strategic positioning and traversal in gameplay.
- **rules-engine.req.md**: Enforces turn sequencing, validations, win conditions (Pyrite erosion), and special rules (e.g., fissure effects, geode powers including those from geode-amethyst.req.md and geode-rose-quartz.req.md), critical for fair operational scenarios.
- **ui-ux.req.md**: Provides the interactive web interface (grid layout, geode colors, hover states, fissure visuals), facilitating user interactions in all operational scenarios with feedback and responsiveness.

Referenced artifacts (context):
Artifact: faction

Requirement (faction.req):
---
artifact: faction
phase: requirement
depends-on: []
references: []
last-updated: 2025-12-17
---

# Geodes Collection - Requirements

## Overview

This requirement specification outlines the design and implementation of a collection of 5 unique geodes, each possessing distinct special powers. The geodes are intended as collectible artifacts for use in the board game "petrified". Each geode must be visually distinct as each piece will have unique powers on the game board. The base faction consists of Pyrite, Rose Quartz, Calcite, Amethyst and Quartz and is collectively called **The Crystalline Guard**. Operationally, players control these geodes in web-based sessions, selecting and moving them strategically during turns, with Pyrite serving as the critical erosion target, under constraints like real-time validation and balanced win rates to promote user engagement.

## Functional Requirements
- FR-1: The collection shall consist of exactly 5 geodes.
- FR-2: Each geode will be able to interact with the board in a distinct way.
- FR-3: Each geode shall possess distinct special powers.
- FR-4: Each geode shall be visually distinct.
- FR-5: The geodes shall be usable as collectible artifacts in the board game "Petrified".
- FR-6: The base faction shall consist of Pyrite, Rose Quartz, Calcite, Amethyst, and Quartz.
- FR-7: The faction shall be collectively called "The Crystalline Guard".
- FR-8: Pyrite shall have the special power to move one space in any direction, with fissures applying.
- FR-9: Rose Quartz shall have the special power to move one space in any direction, with fissures not applying.
- FR-10: Calcite shall have the special power to move any number of spaces in a vertical or horizontal direction, with fissures applying.
- FR-11: Amethyst shall have the special power to move any number of spaces in a diagonal direction, with fissures applying.
- FR-12: Quartz shall have the special power to move any number of spaces in any direction, with fissures applying.
- FR-13: All factions in the game shall include a Pyrite piece, which shall be the target piece that needs to be captured to win the game.
- FR-14: The geodes shall have no additional special powers beyond the movement abilities specified in FR-8 through FR-12.
- FR-15: Players shall control the geodes in web-based game sessions.
- FR-16: Players shall select and move geodes strategically during their turns.
- FR-17: Movement of geodes shall be validated in real-time.

## Non-Functional Requirements
- NFR-1: Usability - Geode interactions shall be intuitive, with clear visual cues (e.g., glow effects for activation) and accessible controls for users with disabilities (e.g., keyboard navigation).
- NFR-2: Maintainability - Geode capabilities shall be expressed as a configuration.
- NFR-3: The game shall maintain balanced win rates to promote user engagement.

## Cross-References
None identified at this time. Potential future dependencies may include game engine specifications or lore documents.

## AI Interaction Log
<!-- Auto-maintained by PromptPress extension -->
---

Design (faction.design):
---
artifact: faction
phase: design
depends-on: ["game-state-manager.design"]
references: ["faction.req"]
last-updated: 2025-12-17
---

# Geodes Collection - Design

## Overview
This design specifies the tabletop gameplay model for the Geodes Collection used in the board game "Petrified". The collection consists of exactly five distinct geodes—Pyrite, Rose Quartz, Calcite, Amethyst, and Quartz—collectively called "The Crystalline Guard". Each geode is a game piece with unique movement rules on the board. There are no powers beyond movement.

The design focuses on movement validation, capture rules, faction composition, and turn sequencing consistent with the requirements. Configuration is used to express geode capabilities for maintainability (NFR-2), and usability is addressed through clear, visual differentiation of pieces (NFR-1). Digital engine integration is out of scope.

## Architecture
The architecture models tabletop gameplay mechanics. Key components:

- **Piece**: Represents a geode with identity, faction, and movement profile. Pieces are visually distinct (material/color) for usability.
- **MoveValidator**: Validates moves based on the piece's movement rules and board state, including fissure obstructions.
- **TurnEngine**: Manages turn order and move execution, including the option to manipulate a fissure as an alternative action on a turn (a cell cannot be manipulated if it was manipulated during the previous turn).
- **Faction**: Defines the set of five pieces for "The Crystalline Guard" and enforces inclusion of Pyrite as the capturable target piece.

All geode capabilities are expressed via configuration to satisfy maintainability (NFR-2). There is no power activation beyond movement. No combination mechanics exist.

## API Contracts
The contracts must be compatible with those defined in @game-state-manager.design.

Interfaces are presented in a language-agnostic style for a simple rules engine.

- **IPiece**:
  - `name(): string` — One of: Pyrite, Rose Quartz, Calcite, Amethyst, Quartz.
  - `movementProfile(): MovementProfile` — Describes allowed moves.
  - `isTarget(): boolean` — True for Pyrite.

- **IMoveValidator**:
  - `canMove(piece: IPiece, from: Coord, to: Coord, board: Board): boolean` — Validates a move per geode rules and board constraints.

- **ITurnEngine**:
  - `applyMove(move: Move): Board` — Applies a validated move, handling captures.
  - `applyFissureManipulation(cell: Coord, action: FissureAction): Board` — Applies fissure rotation or flip, with constraints on consecutive manipulations.
  - `isCapture(move: Move): boolean` — True if destination has an opposing piece; if that piece is Pyrite, the game is won.

- **MovementProfile** (config-driven):
  - `maxStep: number` — Maximum squares per move.
  - `directions: Direction[]` — Allowed directions: `orthogonal`, `diagonal`, `any`.
  - `pattern: string` — Optional descriptor (e.g., `two-step-any` for Quartz).

No activation powers, cooldowns, or resource systems exist.

## Data Model
Capabilities are expressed as configuration (YAML/JSON), satisfying NFR-2. Example:

```
faction: "The Crystalline Guard"
pieces:
  - name: Pyrite
    target: true
    movement:
      directions: any
      maxStep: 1
  - name: Rose Quartz
    target: false
    movement:
      directions: diagonal
      maxStep: unlimited
  - name: Calcite
    target: false
    movement:
      directions: any
      maxStep: 1
  - name: Amethyst
    target: false
    movement:
      directions: orthogonal
      maxStep: unlimited
  - name: Quartz
    target: false
    movement:
      directions: any
      maxStep: 2
```

Notes:
- "unlimited" indicates movement continues along valid direction until blocked.
- Quartz moves exactly two squares in any direction, which may be linear or non-linear (e.g., L-shaped), provided the path adheres to board constraints and fissures do not obstruct.
- Fissures are rotatable and flippable; their state affects movement validation (e.g., certain orientations may block paths).

## Algorithms & Logic
- **Movement Rules**:
  - Pyrite (FR-8, FR-13): Moves one position in any direction; Pyrite is the target piece that, when captured, wins the game.
  - Rose Quartz (FR-9): Moves diagonally, any distance until blocked.
  - Calcite (FR-10): Moves one position in any direction.
  - Amethyst (FR-11): Moves vertically and horizontally, any distance until blocked.
  - Quartz (FR-12): Moves exactly two squares in any direction in a single turn, which may be non-linear (e.g., L-shaped), provided each step adheres to board bounds, obstructions, and fissure states.

- **Move Validation**:
  - Check `directions`, `maxStep`/`pattern`, path obstruction (including fissures), board bounds, and destination occupancy.
  - A move that lands on an opposing piece captures it; capturing opposing Pyrite ends the game (FR-13).

- **Turn Sequence**:
  - Players alternate turns; each turn consists of either selecting a piece and executing one valid move or manipulating one fissure (rotation or flip), provided the cell was not manipulated in the previous turn.

- **No Additional Powers**:
  - There are no effects beyond movement (FR-14). No cooldowns, resources, or combinations.

## Dependencies
- Optional: Serialization library for loading movement configuration (e.g., YAML/JSON parser).
- Physical components: Clearly differentiated piece designs to satisfy NFR-1.

## Questions & Clarifications
The board has fissures, which are rotatable and flippable. They sit inside of the grid cells and a player may use a turn to manipulate one of them as long as that cell has not been manipulated during the previous move.

Quartz can move up to two squares in any direction.

## AI Interaction Log
<!-- Auto-maintained by PromptPress extension -->

Based on these requirements:

---
artifact: geode-calcite
phase: requirement
depends-on: []
references: ["faction.req"]
version: 1.0.0
last-updated: 2025-12-17
---

# Calcite Geode - Requirements

## Overview
This requirement specification details the design, implementation, and operational behavior of the Calcite geode within the board game "Petrified." Calcite is one of the five core geodes in the base faction known as "The Crystalline Guard," as defined in faction.req. It serves as a collectible artifact with unique movement capabilities, allowing strategic positioning on the 5x5 game board grid. Calcite enables players to move any number of spaces vertically or horizontally, with fissure rotations applying to restrict or allow entry into cells. Visually, Calcite is represented as a white or clear piece to ensure distinction from other geodes (e.g., pyrite in yellow, rose quartz in pink, amethyst in purple). Operationally, Calcite integrates with the game board (game-board.req.md), rules engine (rules-engine.req.md), state manager (game-state-manager.req.md), and UI (ui-ux.req.md) to support turn-based web-based gameplay, where players select and move Calcite strategically to capture opponent pieces or block paths, aiming to erode the opponent's Pyrite geode. Calcite has no additional special powers beyond its movement mechanics, promoting balanced gameplay with a focus on mobility and fissure interactions.

## Functional Requirements
- FR-1: Calcite shall be implemented as a distinct game piece within the faction collection, visually represented as a white or clear-colored geode in the UI to ensure easy identification and distinction from other geodes (e.g., pyrite, rose quartz, amethyst, quartz).
- FR-2: Calcite shall allow movement of any number of spaces in a vertical (up/down) or horizontal (left/right) direction on the 5x5 game board grid, starting from its current position, provided the path is unobstructed by other pieces or invalid cells.
- FR-3: Movement of Calcite shall be subject to fissure effects, where rotated fissures in rows 2-4 can block or permit entry into specific cells based on the fissure's orientation and Calcite's movement direction; fissures shall not apply to Calcite's starting or ending strata cells (rows 1 and 5).
- FR-4: Calcite shall support capture mechanics by landing on an opponent's geode space during its movement, removing the opponent's piece from the board, with validation enforced by the rules engine to ensure legal captures (e.g., no capturing allied pieces).
- FR-5: Calcite's movement shall be validated in real-time by the rules engine during player turns, preventing invalid moves (e.g., diagonal steps, jumping over pieces, or entering blocked fissure cells) and providing feedback via the UI (e.g., highlighting valid paths).
- FR-6: Calcite shall integrate with the game state manager to track its position, movement history, and any captures, ensuring state persistence and updates during web-based sessions.
- FR-7: Calcite shall be selectable and movable via the UI during a player's turn, with hover states and click interactions to display potential movement paths and confirm actions.
- FR-8: Calcite shall adhere to turn-based sequencing, allowing movement only during the controlling player's turn, with no simultaneous or out-of-turn actions.
- FR-9: In endgame scenarios, Calcite's position and captures shall contribute to win/loss determination, particularly if it enables the erosion (capture) of the opponent's Pyrite geode.
- FR-10: Calcite shall have no additional special powers beyond the movement and capture abilities specified, ensuring fairness and balance with other geodes in the faction.

## Non-Functional Requirements
- NFR-1: Performance - Calcite's movement calculations and validations shall occur with sub-second latency in standard web browsers to maintain real-time responsiveness during gameplay.
- NFR-2: Usability - The UI representation of Calcite shall include intuitive visual cues (e.g., glow effects on selection, path highlighting for valid moves) and support accessibility features (e.g., keyboard navigation, screen reader compatibility) for users with disabilities.
- NFR-3: Maintainability - Calcite's movement rules and visual properties shall be configurable (e.g., via code parameters) to allow easy updates without affecting other geodes or core game mechanics.
- NFR-4: Scalability - Calcite's implementation shall support multiple simultaneous game sessions without performance degradation, aligning with browser-based constraints.
- NFR-5: Security - No sensitive data shall be associated with Calcite; all interactions shall be validated client-side to prevent cheating or invalid state changes.
- NFR-6: Balance - Calcite's movement range shall be designed to promote balanced win rates (e.g., approximately 50/50 for skilled players), avoiding overpowered dominance while encouraging strategic fissure rotations and captures.

## Questions & Clarifications
[AI-CLARIFY: Confirm if "fissures applying" means specific rules for how fissure rotations (e.g., from fissure-cell.req.md) interact with Calcite's vertical/horizontal movement—does rotation block only certain directions, or does it fully prevent entry? Also, clarify if Calcite can move through or over fissures in non-rotated states, and how this integrates with the center fissure's unique properties (e.g., purple lines for amethyst, but not applicable here). Ensure alignment with game-board.req.md for strata vs. fissure row behaviors.]

## Cross-References
[Leave empty - references are documented in the metadata header]

## AI Interaction Log
<!-- Auto-maintained by PromptPress extension -->

=== AI Response ===
---
artifact: geode-calcite
phase: design
depends-on: []
references: ["geode-calcite.req", "faction.req", "faction.design"]
version: 1.0.0
last-updated: 2025-12-17
---

# Calcite Geode - Design

## Overview
The design for the Calcite geode focuses on implementing its unique movement mechanics (any number of spaces vertically or horizontally, with fissure rotations applying to restrict entry into cells in rows 2-4) as a software component within the web-based "Petrified" game. Calcite is modeled as a game piece with no additional powers beyond movement and capture, ensuring balanced gameplay. The high-level approach leverages modular, configurable code for movement validation, integrated with the game board, rules engine, state manager, and UI. Visual representation uses white/clear styling for distinction. Real-time validation ensures responsiveness, with client-side logic for performance. This design aligns with faction.req and faction.design but prioritizes geode-calcite.req for movement specifics (noting a discrepancy in faction.design's maxStep for Calcite, which is overridden here to match req).

## Architecture
The Calcite geode is implemented as a specialized subclass of a generic Geode class, inheriting base properties (e.g., position, faction) while overriding movement logic. Key components:

- **CalcitePiece Module**: Encapsulates Calcite-specific logic, including movement rules and visual properties. It integrates with the board grid (from game-board.req.md) and fissure states.
- **MovementValidator Submodule**: Handles pathfinding and validation for vertical/horizontal sliding, respecting fissures and obstructions.
- **UI Renderer**: Manages visual rendering (white/clear piece) and interactions (hover, selection, path highlighting).
- **State Integration Layer**: Interfaces with the game state manager for position tracking and the rules engine for turn validation.
- **Layers**: Presentation (UI), Logic (validation/capture), Data (state persistence).

The architecture is event-driven, responding to user inputs (e.g., drag/move via UI) and triggering validations via the rules engine. No server-side logic; all client-side for web compatibility.

## API Contracts
Interfaces are defined in TypeScript-like pseudocode for clarity, assuming integration with game-state-manager.design and faction.design.

- **ICalcitePiece Interface** (extends IPiece from faction.design):
  - `getMovementProfile(): MovementProfile` — Returns { directions: ['vertical', 'horizontal'], maxStep: 'unlimited', fissuresApply: true }
  - `getVisualStyle(): VisualStyle` — Returns { color: 'white', opacity: 0.9, glowEffect: true }
  - `canMove(from: Coord, to: Coord, board: Board, fissures: FissureState[]): boolean` — Validates move per rules (vertical/horizontal sliding, fissure checks).
  - `attemptCapture(targetCoord: Coord, board: Board): boolean` — Checks for opponent piece at destination and removes it if valid.

- **IMovementValidator Interface** (extends IMoveValidator from faction.design):
  - `validatePath(piece: ICalcitePiece, path: Coord[], board: Board, fissures: FissureState[]): ValidationResult` — Computes valid paths (unobstructed vertical/horizontal lines), factoring fissure rotations (e.g., blocks entry if orientation mismatches direction).
  - `isPathBlocked(coord: Coord, direction: 'vertical' | 'horizontal', fissures: FissureState[]): boolean` — Checks fissure state for cell entry (applies to rows 2-4; strata exempt).

- **IUIHandler Interface** (for UI integration):
  - `renderCalcite(piece: ICalcitePiece, gridElement: HTMLElement): void` — Draws white/clear piece with CSS classes (e.g., 'calcite-piece').
  - `highlightPaths(piece: ICalcitePiece, board: Board): Coord[]` — Returns and visually highlights valid move destinations.
  - `onSelect(piece: ICalcitePiece): EventHandler` — Binds click/hover for selection, triggering path preview.

Data structures:
- `Coord: { row: number, col: number }` (0-4 indexed).
- `Board: Coord[][]` (5x5 grid with piece/fissure refs).
- `FissureState: { orientation: 'blocked-vertical' | 'blocked-horizontal' | 'open' }` (based on rotation).

## Data Model
Calcite is represented as a JSON-serializable object in the game state, persisted via game-state-manager.req.md (e.g., to jsonbin.io). No database; in-memory with optional local storage.

Schema:
```
{
  "type": "Calcite",
  "id": "string", // Unique instance ID
  "faction": "The Crystalline Guard",
  "position": { "row": number, "col": number },
  "movementProfile": {
    "directions": ["vertical", "horizontal"],
    "maxStep": "unlimited",
    "fissuresApply": true
  },
  "visual": {
    "color": "white",
    "material": "clear",
    "isSelected": boolean
  },
  "captures": [Coord] // History of captured positions
}
```

Relationships: Calcite belongs to a Faction (from faction.design), interacts with Board cells (strata vs. fissure rows) and other Geodes for captures. Fissure states are referenced from fissure-cell.req.md.

## Algorithms & Logic
- **Movement Validation Algorithm**:
  - Input: from Coord, to Coord, board, fissures.
  - Check if to is on same row (horizontal) or column (vertical); if not, invalid.
  - Compute path: Iterate from from to to in direction, checking each cell for obstructions (other pieces block; fissures apply in rows 2-4 — if orientation blocks direction, invalid).
  - If path clear and to empty or opponent-occupied, valid. Max distance unlimited until blocked.
  - Edge cases: Cannot move to occupied allied cell; fissures don't apply to strata (rows 1/5).

- **Capture Logic**:
  - On landing at to, if occupied by opponent, remove piece and update state. If opponent is Pyrite, trigger win condition via rules-engine.req.md.

- **Turn Integration**:
  - During turn (from rules-engine.req.md), validate move; if valid, update state and UI feedback. Fissure manipulations (from fissure-cell.req.md) can occur instead of move, affecting future Calcite validations.

- **UI Logic**:
  - On hover, highlight valid paths (e.g., CSS glow on cells). On move, animate sliding (vertical/horizontal only).

Business logic ensures balance: Unlimited range encourages positioning but fissure interactions add strategy.

## Dependencies
- **Third-party Libraries**: None required; uses vanilla JS/HTML/CSS for web compatibility. Optional: Lodash for path calculations (lightweight utility).
- **External Services**: jsonbin.io for state persistence (API key required).
- **Internal**: Relies on game-board.req.md (grid), rules-engine.req.md (validation), game-state-manager.req.md (state), ui-ux.req.md (rendering).

## Questions & Clarifications
[AI-CLARIFY: Confirm fissure interaction details—does a 'blocked-vertical' orientation prevent horizontal entry but allow vertical, or vice versa? Clarify if 'any number of spaces' allows stopping mid-path or requires full slide to obstruction. Address discrepancy with faction.design (maxStep:1 vs. unlimited) by aligning with geode-calcite.req. Ensure center fissure (purple lines) has no effect on Calcite, unlike Amethyst.]

## Cross-References
[Leave empty - references are documented in the metadata header above]

## AI Interaction Log
<!-- Auto-maintained by PromptPress extension -->

=== End Log ===
